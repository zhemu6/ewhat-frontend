# AGENTS.md (ewhat-frontend)

本文件面向在本仓库中自动工作的 agent（代码生成/修改/修复）。目标：让 agent 以“跟随仓库现状”为第一原则，不臆造命令、不引入新工具链。

## 项目概览

- 技术栈：Taro 4.1.11 + Vue 3 + TypeScript + NutUI (taro)
- 构建器：Taro CLI（webpack5 runner）
- 包管理器：npm（仓库存在 `package-lock.json`，且 `package.json` scripts 使用 `npm run ...`）
- 入口与配置：
  - 应用入口：`src/app.ts`
  - 全局路由/窗口配置：`src/app.config.ts`
  - 构建配置：`config/index.ts`（按环境合并 `config/dev.ts`、`config/prod.ts`）

## 官方文档（以微信小程序为主）

- Taro 路由：`https://docs.taro.zone/docs/router`
- Taro 路由 API：`https://docs.taro.zone/docs/apis/route/navigateTo`
- NutUI Taro Vue 4.x：`https://nutui.jd.com/taro/vue/4x/#/zh-CN/guide/start`

## 常用命令（Build / Dev / Lint / Test）

### 安装依赖

- 首次/常规：`npm install`
- CI/更可复现：`npm ci`

### 开发（watch）

这些命令等价于对应 build 命令加 `--watch`：

- 微信小程序：`npm run dev:weapp`
- H5：`npm run dev:h5`
- 支付宝：`npm run dev:alipay`
- 头条：`npm run dev:tt`
- QQ：`npm run dev:qq`
- 百度：`npm run dev:swan`
- 快应用：`npm run dev:quickapp`
- RN：`npm run dev:rn`

### 构建（build）

- 微信小程序：`npm run build:weapp`
- H5：`npm run build:h5`
- 支付宝：`npm run build:alipay`
- 头条：`npm run build:tt`
- QQ：`npm run build:qq`
- 百度：`npm run build:swan`
- 快应用：`npm run build:quickapp`
- RN：`npm run build:rn`

### Lint / Typecheck（仓库现状）

当前 `package.json` 没有提供 `lint`/`typecheck` 脚本；仓库存在 ESLint/TS 依赖与配置：

- ESLint 配置：`.eslintrc`（extends: `taro/vue3`）
- TypeScript 配置：`tsconfig.json`

可手动运行（不需要改 `package.json`）：

- ESLint（检查）：`npx eslint "src/**/*.{ts,js,vue}"`
- ESLint（自动修复）：`npx eslint "src/**/*.{ts,js,vue}" --fix`
- TypeScript（仅类型检查）：`npx tsc -p tsconfig.json --noEmit`

Stylelint：仓库安装了 `stylelint` 依赖，但未发现 `.stylelintrc*`/`stylelint.config.*` 配置文件。若要临时检查样式，可尝试：

- `npx stylelint "src/**/*.{css,scss,vue}"`

注意：在缺少项目级配置时，stylelint 可能无法按预期工作；不要在没有证据的情况下把它写成“标准必过”。

### 测试（仓库现状）

- 本仓库未发现测试脚本（`package.json` 无 `test`），也未发现 `*.test.*`/`*.spec.*`/`__tests__` 目录。
- 因此：当前不存在“运行单个测试”的仓库内标准命令。

## 路由（Taro Router，微信小程序约束）

Taro 遵循微信小程序路由规范，页面必须注册在全局配置 `src/app.config.ts` 的 `pages` 中（文档：`https://docs.taro.zone/docs/router`）。

- `Taro.navigateTo`：保留当前页面、打开新页面；不能跳 tabbar；小程序页面栈最多 10 层（文档：`https://docs.taro.zone/docs/apis/route/navigateTo`）
- `Taro.redirectTo`：关闭当前页再打开新页；不能跳 tabbar（文档：`https://docs.taro.zone/docs/apis/route/redirectTo`）
- `Taro.switchTab`：只能跳 tabbar 页面；url 不能带参数（文档：`https://docs.taro.zone/docs/apis/route/switchTab`）
- `Taro.reLaunch`：关闭所有页面并打开指定页面（文档：`https://docs.taro.zone/docs/apis/route/reLaunch`）
- `Taro.navigateBack`：按 delta 返回；可用 getCurrentPages 查看页面栈（文档：`https://docs.taro.zone/docs/apis/route/navigateBack`）
- EventChannel：页面间事件通信通道（文档：`https://docs.taro.zone/docs/apis/route/EventChannel`）

路由参数：通过 `url` 查询串传参；在目标页生命周期里用 `Taro.getCurrentInstance().router.params` 获取（概述示例：`https://docs.taro.zone/docs/router`）。

## 目录结构与约定

- `src/pages/<page>/index.vue`：页面组件
- `src/pages/<page>/index.config.ts`：页面配置（例如标题）
- `src/app.config.ts` 的 `pages` 数组：页面注册（新增页面必须同步注册）

新增页面的最小步骤（示例 `login`）：

1) 新建 `src/pages/login/index.vue`
2) 新建 `src/pages/login/index.config.ts`
3) 在 `src/app.config.ts` 中添加 `pages/login/index`

## 代码风格与规范（以仓库现状为准）

### 格式化（Formatting）

- 缩进：2 空格（见 `.editorconfig`）
- 行尾空白：删除（见 `.editorconfig`）
- 文件末尾：保留换行（见 `.editorconfig`）
- 引号/分号：仓库存在“混用”（例如 `src/app.ts` 使用双引号与分号；多数 `.vue` `<script setup>` 倾向无分号）。
  - 规则：改动时尽量保持所在文件的既有风格，避免无意义重排。

### Import 习惯

- 常见分组顺序（从 `src/app.ts` 观察到的现状）：
  1) 框架/运行时（如 `vue`）
  2) 第三方库（如 `@nutui/nutui-taro`）
  3) 第三方样式（如 `@nutui/nutui-taro/dist/style.css`）
  4) 本地样式/本地模块（如 `./app.scss`）
- 避免为“对齐/排序”而重排 import；只在新增/删除依赖时调整。

### TypeScript 约束

- `tsconfig.json` 关键点：
  - `strictNullChecks: true`
  - `noImplicitAny: false`（历史原因偏宽松，但新代码仍应尽量避免隐式 any）
  - `noUnusedLocals/noUnusedParameters: true`
- 新增/修改公共 API（组件 props、工具函数、配置对象）时：
  - 优先显式类型（尤其是返回值、参数、跨文件导出）
  - 使用 `satisfies` 做配置对象校验（仓库现状：`config/dev.ts`、`config/prod.ts`）

### Vue 3（SFC）

- 推荐使用 `<script setup>` + Composition API（现状：`src/pages/index/index.vue`）
- 模板中使用 Taro 组件标签（如 `<view>`），避免直接用 DOM-only 标签/能力（兼容小程序端）
- 组件命名：
  - 模板中第三方组件多用 kebab-case（如 `<nut-button>`）
  - 变量/函数名用 camelCase（如 `show`, `onClick`）

### Taro/多端兼容注意

- 不要默认可以使用浏览器专属 API（window/document/localStorage 等），除非明确是 H5 端逻辑且已做条件分支。
- 页面路由必须通过 `src/app.config.ts` 注册；否则构建/运行期不会被识别。
- `config/index.ts` 中 `designWidth()` 对 NutUI 设为 375，其它默认 750；引入新 UI 库时留意 pxtransform 行为。

### 自动生成文件

- `components.d.ts` 标注为 “Generated by unplugin-vue-components”，且包含 `// @ts-nocheck`。
  - 规则：不要手工修改此文件；如果需要更新，走对应插件的生成流程（通常由构建/开发时生成）。

### 错误处理（通用底线）

- 不要吞掉异常（避免空 `catch {}`）。
- 需要捕获时：记录足够上下文（平台/路由/关键参数），并给用户可理解的反馈（Toast/提示等）。
- 不要用类型抑制来“糊过去”（避免 `as any` / `@ts-ignore` / `@ts-expect-error`），除非文件本身是生成物且已明确豁免。

## 路径别名与解析

- 构建侧已启用 `tsconfig-paths-webpack-plugin`（见 `config/index.ts`），但 `tsconfig.json` 当前未定义 `compilerOptions.paths`。
- 规则：不要假设存在 `@/` 别名；如需别名，必须同时更新 `tsconfig.json` 并确保构建可解析。

## IDE / Agent 规则文件

- 未发现 Cursor 规则（`.cursor/rules/*` 或 `.cursorrules`）。
- 未发现 Copilot 规则（`.github/copilot-instructions.md`）。
- 本仓库存在 `.idea/`（JetBrains 工程文件）；除非任务明确要求，否则不要改动。

## NutUI（Taro Vue，小程序）

由于 NutUI 官方文档页面需要 JavaScript 才能完整渲染，且本仓库已完成核心接入（见 `src/app.ts`、`config/index.ts`、`components.d.ts`），后续开发默认遵循以下仓库现状：

- 样式：全局引入 `@nutui/nutui-taro/dist/style.css`（见 `src/app.ts`）
- 组件使用：模板中使用 kebab-case（如 `<nut-button>`、`<nut-toast>`，见 `src/pages/index/index.vue`）
- 自动导入：已配置 `unplugin-vue-components` + `@nutui/auto-import-resolver`（`NutUIResolver({ taro: true })`，见 `config/index.ts`）
- 类型生成：`components.d.ts` 为自动生成文件，不要手改

## 最小验证清单（提交前/交付前）

- 能跑通目标平台的 dev 或 build：`npm run dev:<platform>` 或 `npm run build:<platform>`
- 如本次改动涉及 TS：跑 `npx tsc -p tsconfig.json --noEmit`
- 如本次改动涉及大量源码：跑 `npx eslint "src/**/*.{ts,js,vue}"`（必要时加 `--fix`）
